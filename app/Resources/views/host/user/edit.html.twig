{% extends 'host/base.html.twig' %}
{% block table %}
    <div class="row">
        <div class="col-sm-3">
            <ul class="nav nav-pills nav-stacked">
                <li class="active"><a href="#profil" data-toggle="tab">{% trans %}label.edit_profil{% endtrans %} </a></li>
                <li><a href="#picture" data-toggle="tab">{% trans %}label.profil_picture{% endtrans %} </a></li>
                <li><a href="#password" data-toggle="tab">{% trans %}label.edit_password{% endtrans %} </a></li>
                <li><a href="#notifications" data-toggle="tab">{% trans %}label.notifications{% endtrans %} </a></li>
            </ul>
        </div>
        <div class="col-sm-9">
            <div class="tab-content">
                <div class="tab-pane fade in active" id="profil">
                    {% if app.session.flashBag.has('userSuccess') %}
                        <div class="alert alert-success">
                            {% for msg in app.session.flashBag.get('userSuccess') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if app.session.flashBag.has('userError') %}
                        <div class="alert alert-danger">
                            {% for msg in app.session.flashBag.get('userError') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    {{ form_start(userForm) }}
                        {{ form_errors(userForm) }}
                        <div>
                            <h4>Infos obligatoires</h4>
                            <div class="form-group">
                                <label>*{% trans %}label.first_name{% endtrans %} </label>
                                {{ form_errors(userForm.firstName)}}
                                {{ form_widget(userForm.firstName,  { 'attr': {'class': 'form-control'} }) }}
                            </div>
                            {{ form_start(userForm) }}
                            <div class="form-group">
                                <label>*{% trans %}label.last_name{% endtrans %} </label>
                                {{ form_errors(userForm.lastName)}}
                                {{ form_widget(userForm.lastName,  { 'attr': {'class': 'form-control'} }) }}
                            </div>
                            <div class="form-group">
                                <label>*{% trans %}label.birth_date{% endtrans %} </label>
                                {{ form_errors(userForm.birthDate)}}
                                <div id="sandbox-container">
                                    <div class="input-group date">
                                        {{ form_widget(userForm.birthDate) }}<span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>*{% trans %}label.sex{% endtrans %} </label>
                                {{ form_errors(userForm.sex)}}
                                {{ form_widget(userForm.sex,  { 'attr': {'class': 'form-control'} }) }}
                            </div>
                            <div class="form-group">
                                <label>*{% trans %}label.phone_number{% endtrans %} </label>
                                {{ form_errors(userForm.phoneNumber)}}
                                {{ form_widget(userForm.phoneNumber,  { 'attr': {'class': 'form-control'} }) }}
                            </div>
                            <div class="form-group">
                                <label>*{% trans %}label.email{% endtrans %} </label>
                                {{ form_errors(userForm.email)}}
                                {{ form_widget(userForm.email,  { 'attr': {'class': 'form-control'} }) }}
                            </div>
                        </div>
                        <br>
                        <div>
                            <h4>Infos compl√©mentaires</h4>
                            <div class="form-group">
                                <div class="form-group">
                                    <label>{% trans %}label.description{% endtrans %} </label>
                                    {{ form_errors(userForm.description)}}
                                    {{ form_widget(userForm.description,  { 'attr': {'class': 'form-control'} }) }}
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary pull-right">{% trans %}label.submit{% endtrans %}</button>
                    {{ form_end(userForm) }}
                </div>
                <div class="tab-pane fade in" id="picture">
                    {% if app.session.flashBag.has('pictureSuccess') %}
                        <div class="alert alert-success">
                            {% for msg in app.session.flashBag.get('pictureSuccess') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if app.session.flashBag.has('pictureError') %}
                        <div class="alert alert-danger">
                            {% for msg in app.session.flashBag.get('pictureError') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    <img src="{{ picturePath ~ picture}}" width="200px" height="auto">
                    <br><br>
                    <h4>{% trans %}label.edit_picture{% endtrans %} :</h4>
                    <form name="picture" method="post" enctype='multipart/form-data'>
                        <input name="picture" type="file" required>
                        <button type="submit" class="btn btn-primary pull-right">{% trans %}label.submit{% endtrans %}</button>
                    </form>
                </div>
                <div class="tab-pane fade in" id="password">
                    {% if app.session.flashBag.has('passwordSuccess') %}
                        <div class="alert alert-success">
                            {% for msg in app.session.flashBag.get('passwordSuccess') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if app.session.flashBag.has('passwordError') %}
                        <div class="alert alert-danger">
                            {% for msg in app.session.flashBag.get('passwordError') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    <h4>{% trans %}label.edit_password{% endtrans %}</h4>
                    {{ form_start(passwordForm) }}
                        {{ form_errors(passwordForm) }}
                        <div class="form-group">
                            {{ form_row(passwordForm.currentPassword) }}
                        </div>
                        <div class="form-group">
                            {{ form_row(passwordForm.password.first) }}
                        </div>
                        <div class="form-group">
                            {{ form_row(passwordForm.password.second) }}
                        </div>
                        {{ form_row(passwordForm.submit) }}
                    {{ form_end(passwordForm) }}
                </div>
                <div class="tab-pane fade in" id="notifications">
                    {% if app.session.flashBag.has('subscriptionsSuccess') %}
                        <div class="alert alert-success">
                            {% for msg in app.session.flashBag.get('subscriptionsSuccess') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if app.session.flashBag.has('subscriptionsError') %}
                        <div class="alert alert-danger">
                            {% for msg in app.session.flashBag.get('subscriptionsError') %}
                                {{ msg }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    <form name="subscriptionForm" method="post">
                        {% set i = 0 %}
                        {% for format,subscriptions in subscriptionFormatList %}
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4>{{ format }}</h4>
                                </div>
                                <div class="panel-body">
                                    {% for subscription in subscriptions %}
                                        {% set name = "subscriptionForm[subscription]["~i~"][value]" %}
                                        <div class="form-group">
                                            <input name="subscriptionForm[subscription][{{ i }}][id]" value="{{ subscription.activated }}" hidden>
                                            {% set checked = "" %}
                                            {#{% if subscription.value == 1 %}#}
                                                {#{% set checked = "checked" %}#}
                                            {#{% endif %}#}
                                            {{ subscription.subscriptionTrs[0].name }}
                                            <input name="{{ name }}" type="checkbox" value="0" hidden checked>
                                            <input name="{{ name }}" type="checkbox" {{ checked }} value="1">
                                        </div>
                                        {% set i = i+1 %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                        <button type="submit" class="btn btn-primary pull-right">{% trans %}label.submit{% endtrans %}</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% block script %}
        <script>
            function getFormattedDate(date) {
                var year = date.getFullYear();
                var month = (1 + date.getMonth()).toString();
                month = month.length > 1 ? month : '0' + month;
                var day = date.getDate().toString();
                day = day.length > 1 ? day : '0' + day;
                return day  + '-' + month + '-' + year;
            }
            $(document).ready(function() {
                var today =  new Date();
                $('#sandbox-container .input-group.date').datepicker({
                    endDate: ""+getFormattedDate(today)+"'",
                    format: 'dd-mm-yyyy',
                    autoclose: true
                });
            });
        </script>
    {% endblock %}
{% endblock %}
